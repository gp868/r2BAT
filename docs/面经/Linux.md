# Linux

- CPU占用过高如何检测？

  1. 使用top命令，实时显示进程CPU百分比和内存使用情况，找出CPU占用较高的进程pid。

  2. 使用ps命令，查询进程中哪个线程的cpu占用率高，记住TID：`ps -mp pid -o THREAD,tid,time`。

   其中，-m显示所有的线程，-p表示pid进程使用cpu的时间，-o表示该参数后是用户自定义格式，如：THREAD,tid,time表示线程、线程ID号、线程占用的时间。

  3. 将TID转换为16进制格式（英文小写格式） `printf “%x\n” tid`

  4. 通过`jstack`命令获取占用资源异常的线程栈：

   ```c
   jstack pid > jstack.pid.log #先保存文件，再从文件中查看
   或者
   jstack 514 |grep 202 -A 30  #直接命令行查看
   ```

  5. 从上面日志文件或者命令行查看日志，从日志中能看到自己编写的代码的类和方法，一般情况是对应代码处产生了死循环。

- kill和kill -9的区别

  1. 杀死进程的方式不同：kill命令发送的是SIGTERM信号，它是一个可以被捕获或忽略的信号，可以让进程有机会进行清理和保存数据。而kill -9命令发送的是SIGKILL信号，它是一个不能被捕获或忽略的信号，会强制终止进程，不会给进程进行任何清理操作的机会。

  2. 对进程的影响不同：kill命令发送SIGTERM信号可以让进程有机会进行清理和保存数据，可以有效避免数据丢失的情况。kill -9命令强制终止进程，可能会导致未完成的数据丢失，甚至会对系统造成影响。

  因此，在正常情况下应该尽量使用kill命令，避免使用kill -9命令。只有在进程无法响应其他信号时，或者必须立即终止一个进程时，才应该使用kill -9命令。

- GDB如何使用

  GDB是一种用于调试程序的工具，可以帮助程序员找出程序中的错误和问题。下面是使用GDB的基本步骤：

  1. 编译程序时加上-g选项，生成可调试的程序。

  2. 打开终端，输入gdb命令，进入GDB调试环境。

  3. 在GDB环境中，输入run命令，运行程序。

  4. 如果程序出现错误，GDB会停止程序的执行，并显示出错的位置。

  5. 可以使用backtrace命令查看函数调用栈，使用print命令查看变量的值，使用step命令逐行执行程序，使用break命令设置断点等。

  6. 如果需要退出GDB环境，可以使用quit命令。

  需要注意的是，GDB调试需要一定的技巧和经验，对于复杂的程序，可能需要花费较长的时间来找出问题。因此，建议在编写程序时尽可能避免出现错误，以减少调试的时间和精力。

  GDB是一款常用的调试工具，可以帮助程序员在开发过程中定位和解决程序中的错误。更详细的GDB使用方法：

  1. 编译程序时需要加上调试信息选项：-g

  例如：

  ```
  gcc -g -o myprogram myprogram.c
  ```

  2. 启动GDB

  在命令行中输入：

  ```
  gdb myprogram
  ```

  3. 设置断点

  在需要调试的代码行前加上断点：

  ```
  break main
  ```

  或者直接在GDB中输入：

  ```
  b main
  ```

  4. 运行程序

  在GDB中输入：

  ```
  run
  ```

  5. 调试程序

  程序运行到断点处时会停止，可以使用以下命令进行调试：

  - step：单步执行程序，进入函数内部
  - next：单步执行程序，不进入函数内部
  - print：打印变量的值
  - backtrace：查看函数调用栈
  - continue：继续执行程序直到下一个断点或程序结束

  6. 查看变量值

  在GDB中输入：

  ```
  print variable_name
  ```

  可以查看变量的值。

  7. 修改变量值

  在GDB中输入：

  ```
  set variable_name = new_value
  ```

  可以修改变量的值。

  8. 退出GDB

  在GDB中输入：

  ```
  quit
  ```

- 怎么使一个命令在后台运行?

  使用 & 在命令结尾来让程序自动运行。(命令后可以不追加空格)

- 用什么命令对一个文件的内容进行统计？(行号、单词数、字节数)

  wc ：- c 统计字节数 - l 统计行数 - w 统计字数。(word count)

- scp：本地和远程互传文件

- ps：查看当前进程

  ![img](https://gcore.jsdelivr.net/gh/gp868/myFigures/img/818047-20200905084700484-530981088.png)

- top：可实时显示进程CPU百分比和内存使用情况

  [Linux top命令详解 - 牛奔 - 博客园 (cnblogs.com)](https://www.cnblogs.com/niuben/p/12017242.html)

  ![img](https://gcore.jsdelivr.net/gh/gp868/myFigures/img/1303876-20191210152709726-52408463.png)

- job：查看后台任务

- lsof：查看所有被进程打开的文件(list opened files)

- 如何查看进程打开的文件

  - ps -aux 获得当前所有的进程，获得pid
  - lsof -p $PID
  - lsof -c programe-name
  - 看文件对应的进程： lsof file-name

- 介绍nm与ldd命令

  - nm (name) ：查看文件中的符号表，如常用的函数名、变量等，以及这些符号存储的区域，`nm [option(s)] [file(s)]`
  - ldd (list dynamic dependencies)：列出程序运行所需要的动态链接库，`ldd 可执行程序路径`

- shell命令查内存，端口 ，io访问量，读写速率

  - top监控系统状态

- 常见命令netstat iptable tcpdump top

  - tcpdump：root权限下使用的抓包工具，只能抓取流经本机的数据包
  - netstate：用于显示网络状态，netstate -a 显示所有连线中的socket
  - top：监控Linux的系统状况
  - iptables：对Linux系统中通信的数据包进行一定的检测，达到防火墙的目的

- gdb查看堆栈中所有遍历

  可以使用gdb的backtrace命令来查看堆栈中所有的遍历。

  步骤如下：

  1. 在终端中使用gdb命令打开要调试的程序。

  2. 在gdb中输入run命令以运行程序。

  3. 当程序出现问题时，使用ctrl+c来中断程序的执行。

  4. 输入backtrace命令来查看堆栈中所有的遍历。

  例如：

  ```
  (gdb) backtrace
  #0 0x0000000000400520 in main ()
  #1 0x00007ffff7a1e830 in __libc_start_main (main=0x400510, argc=1, argv=0x7fffffffe1d8, init=<optimized out>, fini=<optimized out>, rtld_fini=<optimized out>, stack_end=0x7fffffffe1c8) at libc-start.c:291
  #2 0x00000000004003d9 in _start ()
  ```

- ctrl+c 发的是什么信号

  Ctrl+C：发送 SIGINT 信号（程序终止(interrupt)信号）给前台进程组中的所有进程，常用于终止正在运行的程序；

  Ctrl+Z：发送 SIGTSTP 信号（停止进程的运行，但该信号可以被处理和忽略）给前台进程组中的所有进程，常用于挂起一个进程。如果需要恢复到前台使用fg命令，恢复到后台使用bg命令。

  Ctrl+D：不是发送信号，而是表示一个特殊的二进制值，表示 EOF。EOF是End Of File的缩写，通常在文本末尾使用此字符表示文本结束。

- Linux如何查服务运行在哪个端口？

  Linux可以使用以下命令来查找服务运行在哪个端口：

  1. netstat命令

  使用netstat命令可以列出当前系统上所有的网络连接和监听端口。可以使用以下命令来查找某个服务所使用的端口：

  ```
  netstat -anp | grep 服务名
  ```

  其中，-a表示列出所有的连接和监听端口，-n表示以数字形式显示端口号，-p表示显示与端口相关的进程信息，grep用于查找服务名。

  2. lsof命令

  lsof是一个可以列出当前系统打开的所有文件和网络连接的工具。可以使用以下命令来查找某个服务所使用的端口：

  ```
  lsof -i :端口号
  ```

  其中，-i表示查找网络连接，:端口号表示要查找的端口号。

  3. ss命令

  ss是一个更快速和更高效的netstat替代品，可以用来列出当前系统上所有的网络连接和监听端口。可以使用以下命令来查找某个服务所使用的端口：

  ```
  ss -ant | grep 端口号
  ```

  其中，-a表示列出所有的连接和监听端口，-n表示以数字形式显示端口号，-t表示只列出TCP连接，grep用于查找端口号。

- chmod 741 代表什么

  文件权限主要有3部分组成，user用户的权限，group用户组的权限，other其他用户的权限；每部分权限都由 r(读)-w(写)-x(执行) 3部分组成组成，其中的代表数值为： r(4)-w(2)-x(1) ，修改权限的时候，只要通过命令给文件赋予对应的值即可。

  chmod 741 myFile #这里是修改myFile文件，这里的的741每个数字分别代表着不同部分的权限，user 用户赋予 (r-w-x =既4+2+1=7) 的权限，group 赋予 w(4) 权限，other 赋予 x(1) 权限

- Linux中du,df两个命令的区别

  Linux中du和df是两个常用的磁盘空间查询命令，它们的区别如下：

  1. du命令是用来查看指定目录或文件所占用的磁盘空间大小，它会递归地统计目录下所有文件和子目录的大小，并将结果显示出来；df命令是用来显示文件系统的磁盘空间使用情况，它会列出文件系统的名称、总容量、已用空间、可用空间和挂载点等信息。
  2. du命令的单位默认为字节，可以通过参数-k、-m、-g等来指定显示单位为KB、MB、GB等；df命令的单位默认为KB，可以通过参数-h、-H等来指定显示单位为可读性更好的GB、MB等。
  3. du命令只能查看指定目录或文件的大小，而df命令可以查看整个文件系统的磁盘空间使用情况。

  因此，du和df命令的作用不同，使用场景也不同。一般来说，du命令用于查看某个目录或文件所占用的空间大小，df命令用于查看文件系统的磁盘空间使用情况。

- Linux下的/var 目录有什么用

  在Linux中，`/var`目录主要用于存放在系统运行过程中动态产生的变化文件，包括缓存、日志文件和软件运行时需要的其他数据等。具体来说，`/var`目录下常见子目录的作用如下：

  - `/var/cache`: 存放被程序缓存的文件，例如apt等软件包管理器下载的软件包。
  - `/var/log`: 存放系统的日志文件，包括内核日志、应用程序日志、登录记录和错误日志等。在这个目录下，还有许多子目录可以进一步分类和存储不同类型的日志信息，例如`/var/log/messages`是记录系统消息的文件，`/var/log/auth.log`是记录身份验证相关信息的文件。
  - `/var/spool`: 存放需要等待处理的任务，例如邮件队列、打印队列等。
  - `/var/lib`: 存放某些软件的库文件、数据库等数据文件。例如MySQL数据库的数据文件默认就会存放在这个目录下。
  - `/var/run`: 存放正在运行的进程相关信息，例如PID文件等。

  需要注意的是，由于`/var`目录下的文件通常是动态生成的，因此其中的数据可能随着时间的推移不断增长，占用硬盘空间。因此，在设计文件系统的时候，我们需要考虑给`/var`目录足够的空间，并及时清理其中不必要的或已经过期的文件。

- free命令：用于显示系统内存的情况，包括内存总量、已用内存、空闲内存等。常用的命令选项包括“free”和“free -h”，可以显示内存的详细信息。
- tcpdump命令：用于抓取网络数据包并分析其内容，可以用于网络故障排除、网络安全等方面。常用的命令选项包括“tcpdump -i 网卡名称”和“tcpdump -n”，可以抓取指定网卡的数据包并显示详细信息。

- 有一个运行的进程突然挂掉，怎么查看它是哪里出问题了？

  当一个进程突然挂掉时，我们需要查看系统日志来确定出问题的原因。具体的操作步骤如下：

  1. 使用命令 `ps -ef | grep 进程名` 查看进程是否还在运行。如果进程已经退出，输出为空；如果进程仍在运行，输出进程的相关信息，包括进程的PID。

  2. 使用命令 `dmesg` 或 `journalctl` 查看系统日志，查找和该进程相关的日志信息。可以使用 `dmesg | grep 进程名` 或 `journalctl -u 进程名` 来过滤相关的日志信息。如果没有找到任何有用的信息，可以使用 `dmesg -T` 或 `journalctl -u 进程名 -n 100` 来显示更多的日志信息。

  3. 如果系统日志中没有找到有用的信息，可以使用进程监控工具来查看进程的运行情况。常用的进程监控工具包括 `top`、`htop`、`ps`、`pidstat` 等。可以使用命令 `top -p 进程PID` 或 `htop -p 进程PID` 来查看进程的CPU、内存等资源占用情况；使用 `ps -p 进程PID -o pid,ppid,%cpu,%mem,cmd` 来查看进程的PID、PPID、CPU占用率、内存占用率和命令行等信息；使用 `pidstat -p 进程PID` 来查看进程的CPU、内存等资源使用情况。

  4. 最后，如果以上方法都没有找到问题的原因，可以尝试重启进程或者重启系统，以解决问题。同时，建议记录下系统日志和进程监控信息，以便后续分析和排查类似问题。

  除了前面提到的方法，还有一些其他的技巧可以用来定位和解决进程挂掉的问题，例如：

  1. 使用 `strace` 命令来跟踪进程的系统调用，以查看进程与系统之间的交互情况。可以使用 `strace -p 进程PID` 命令来跟踪进程的系统调用，从而确定进程是否存在异常的系统调用。

  2. 使用 `gdb` 命令来调试进程，以查看进程在运行时的内部状态。可以使用 `gdb -p 进程PID` 命令来附加到进程并进入调试模式，从而查看进程的堆栈、寄存器、变量等信息，以确定进程是否存在内存泄漏、代码异常等问题。

  3. 使用 `lsof` 命令来查看进程打开的文件和网络连接。可以使用 `lsof -p 进程PID` 命令来查看进程打开的文件、套接字和网络连接等信息，以确定进程是否存在文件句柄泄漏、网络连接异常等问题。

  4. 使用 `perf` 命令来进行性能分析，以查看进程的性能问题。可以使用 `perf record -p 进程PID` 命令来记录进程的性能数据，使用 `perf report` 命令来生成性能报告，从而确定进程是否存在性能瓶颈、死锁等问题。

  总之，确定进程挂掉的原因需要使用多种方法综合分析，有时需要结合多种工具和技术来进行定位和解决。

- linux系统运行缓慢，通过什么命令查看

  当 Linux 系统运行缓慢时，可以使用以下命令来查看系统的性能瓶颈和资源占用情况：

  1. `top` 命令：可以实时查看系统的 CPU、内存、I/O 等资源占用情况，以及进程的 CPU 占用率、内存占用率等信息。可以使用 `top -c` 命令来显示完整的进程命令行信息。

  2. `htop` 命令：类似于 `top` 命令，但是支持鼠标交互和颜色显示，更加直观和易用。

  3. `vmstat` 命令：可以查看系统的虚拟内存、CPU、I/O 等性能指标。可以使用 `vmstat 1` 命令来实时监控系统的性能指标。

  4. `iostat` 命令：可以查看系统的磁盘 I/O 情况，包括磁盘读写速度、IOPS、响应时间等指标。可以使用 `iostat -x 1` 命令来实时监控磁盘 I/O 情况。

  5. `sar` 命令：可以查看系统的 CPU、内存、磁盘、网络等性能指标，支持生成报告和图表分析。可以使用 `sar -u 1` 命令来实时监控 CPU 使用情况。

  6. `free` 命令：可以查看系统的内存使用情况，包括物理内存和交换空间的使用情况。可以使用 `free -h` 命令来以人类可读的方式显示内存使用情况。

  7. `netstat` 命令：可以查看系统的网络连接情况，包括 TCP、UDP 连接、监听端口等信息。可以使用 `netstat -anp` 命令来显示所有连接和进程信息。

  以上命令只是常用的一部分，还有其他一些工具和命令可以用来监视和分析系统的性能瓶颈和资源占用情况。

  当 Linux 系统运行缓慢时，还可以使用以下命令和技巧来查看问题和解决问题：

  1. `ps` 命令：可以查看系统的进程信息，包括进程的 PID、命令、CPU 占用率、内存占用率等信息。可以使用 `ps -ef` 命令来显示所有进程信息。

  2. `lsof` 命令：可以查看系统中打开的文件和网络连接，包括文件名、文件描述符、进程 ID 等信息。可以使用 `lsof -i` 命令来显示所有打开的网络连接。

  3. `strace` 命令：可以跟踪进程的系统调用，以查看进程与系统之间的交互情况。可以使用 `strace -p 进程PID` 命令来跟踪进程的系统调用。

  4. `iotop` 命令：可以查看系统的磁盘 I/O 情况，包括进程的 I/O 占用情况、磁盘读写速度等信息。可以使用 `iotop -o` 命令来按照 I/O 占用率排序。

  5. `sar` 命令：可以查看系统的 CPU、内存、磁盘、网络等性能指标，支持生成报告和图表分析。可以使用 `sar -u 1` 命令来实时监控 CPU 使用情况。

  6. 使用 `top` 或 `htop` 命令，查看系统进程的 CPU 占用率、内存占用率等指标，并根据需要进行进程的调整和优化。

  7. 检查系统日志，查看是否有异常信息和错误信息，例如 `/var/log/messages`、`/var/log/syslog` 等。

  8. 检查系统磁盘空间和文件系统，查看是否存在磁盘空间不足、文件系统错误等问题。

  以上命令和技巧可以帮助我们找到系统运行缓慢的原因，并采取相应的措施来解决问题。

- 如果rm以及rm -f一个正在被使用的文件，会发生什么？

  如果使用`rm`或`rm -f`命令删除一个正在被使用的文件，会发生以下情况：

  1. 如果该文件被一个进程打开，并且该进程仍在运行，则该文件的目录项被删除，但该文件的磁盘空间并未被释放，因为该文件仍然被进程占用。此时，该文件对应的硬链接计数器会减1，但该文件的实际内容仍然存在于磁盘上，并且可以通过/proc/<PID>/fd目录下的文件描述符链接访问该文件的内容。

  2. 如果该文件被一个进程打开，并且该进程已经关闭了该文件，但是其他进程仍在使用该文件，则该文件的目录项被删除，但该文件的磁盘空间并未被释放，因为该文件仍然被其他进程占用。此时，该文件对应的硬链接计数器会减1，但该文件的实际内容仍然存在于磁盘上，并且可以通过其他进程访问该文件的内容。

  3. 如果该文件被所有进程都关闭了，则该文件的目录项被删除，并且该文件的磁盘空间被释放。此时，该文件对应的硬链接计数器会减1，如果该文件的硬链接计数器变为0，则该文件的磁盘空间被完全释放，该文件被彻底删除。

  需要注意的是，即使使用`rm -f`命令强制删除一个正在被使用的文件，该文件仍然会被占用，直到占用该文件的进程关闭该文件或者被终止。因此，在使用`rm -f`命令删除一个文件之前，应该确保该文件没有被其他进程占用，否则可能会导致数据丢失或者其他问题。

- 

